<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Digital Codes Generator</title>
	<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'>
		<rect width='32' height='32' fill='%23007bff'/>
		<g fill='white'>
		<rect x='2' y='2' width='4' height='4'/>
		<rect x='8' y='2' width='2' height='4'/>
		<rect x='12' y='2' width='4' height='4'/>
		<rect x='18' y='2' width='2' height='4'/>
		<rect x='22' y='2' width='4' height='4'/>
		<rect x='28' y='2' width='2' height='4'/>
		<rect x='2' y='8' width='2' height='4'/>
		<rect x='6' y='8' width='4' height='4'/>
		<rect x='12' y='8' width='2' height='4'/>
		<rect x='16' y='8' width='4' height='4'/>
		<rect x='22' y='8' width='2' height='4'/>
		<rect x='26' y='8' width='4' height='4'/>
		<rect x='2' y='14' width='4' height='4'/>
		<rect x='8' y='14' width='2' height='4'/>
		<rect x='12' y='14' width='4' height='4'/>
		<rect x='18' y='14' width='2' height='4'/>
		<rect x='22' y='14' width='4' height='4'/>
		<rect x='28' y='14' width='2' height='4'/>
		<rect x='2' y='20' width='2' height='4'/>
		<rect x='6' y='20' width='4' height='4'/>
		<rect x='12' y='20' width='2' height='4'/>
		<rect x='16' y='20' width='4' height='4'/>
		<rect x='22' y='20' width='2' height='4'/>
		<rect x='26' y='20' width='4' height='4'/>
		<rect x='2' y='26' width='4' height='4'/>
		<rect x='8' y='26' width='2' height='4'/>
		<rect x='12' y='26' width='4' height='4'/>
		<rect x='18' y='26' width='2' height='4'/>
		<rect x='22' y='26' width='4' height='4'/>
		<rect x='28' y='26' width='2' height='4'/>
		</g>
		</svg>">
 <!-- Google tag (gtag.js) - ADD IT HERE -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZHMD6QT0P"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JZHMD6QT0P');
    </script>
    <!-- End Google tag -->
    <script src=https://cdn.jsdelivr.net/npm/bwip-js@3.0.0/dist/bwip-js.min.js></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">	

<style>
			body {
			background-color: #f2e8d5;  /* Papyrus color */
			background-image: url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='egyptian' x='0' y='0' width='120' height='120' patternUnits='userSpaceOnUse'%3E%3Cg fill='%23c9a961' fill-opacity='0.15'%3E%3C!-- Lotus flower --%3E%3Cpath d='M60 20 L55 30 L50 35 L55 40 L60 35 L65 40 L70 35 L65 30 Z'/%3E%3Ccircle cx='60' cy='18' r='3'/%3E%3C!-- Ankh symbol --%3E%3Ccircle cx='20' cy='45' r='4'/%3E%3Crect x='18' y='49' width='4' height='15'/%3E%3Crect x='14' y='56' width='12' height='3'/%3E%3C!-- Eye of Horus --%3E%3Cellipse cx='100' cy='50' rx='8' ry='5'/%3E%3Ccircle cx='100' cy='50' r='2'/%3E%3Cpath d='M92 50 Q95 55 100 55'/%3E%3C!-- Scarab beetle --%3E%3Cellipse cx='60' cy='85' rx='10' ry='8'/%3E%3Ccircle cx='55' cy='83' r='2'/%3E%3Ccircle cx='65' cy='83' r='2'/%3E%3Cpath d='M50 85 L48 90 M70 85 L72 90'/%3E%3C!-- Decorative borders --%3E%3Crect x='0' y='0' width='120' height='2'/%3E%3Crect x='0' y='118' width='120' height='2'/%3E%3Crect x='0' y='0' width='2' height='120'/%3E%3Crect x='118' y='0' width='2' height='120'/%3E%3C!-- Small ornamental dots --%3E%3Ccircle cx='30' cy='100' r='1.5'/%3E%3Ccircle cx='90' cy='100' r='1.5'/%3E%3Ccircle cx='30' cy='20' r='1.5'/%3E%3Ccircle cx='90' cy='20' r='1.5'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23egyptian)'/%3E%3C/svg%3E");
			min-height: 100vh;
			margin: 0;
			padding: 20px;
			display: grid;
			grid-template-areas: 
				"header header"
				"generate generate"
				"mode mode"
				"form main"
				"form main";
			grid-template-columns: 350px 1fr;
			grid-template-rows: auto 1fr auto;
			gap: 20px;
			align-items: start;
		}

		/* Header area for buttons */
		.header-section {
			grid-area: header;
			display: flex;
			flex-direction: column;
			gap: 0px;
			font-size: 24px;
			padding: 20px 40px;
			background-color: #4CAF50;
		
		}

		button {
			font-size: 24px;
			padding: 20px 40px;
			background-color: #4CAF50;
			color: white;
			border: none;
			cursor: pointer;
			border-radius: 5px;
			margin-bottom: 10px;
			margin-top: 0px;  
			width: 20%;
			min-height: 60px;
		}


		.utility-button:hover {
		background-color: #0056b3 !important;  /* Blue hover instead of green */
		}


		.utility-button {
			font-size: 12px;
			padding: 6px 12px;
			background-color: #007bff;
			color: white;
			border: none;
			cursor: pointer;
			border-radius: 4px;
			margin-right: 10px;
			margin-bottom: 10px;
		}

		.utility-button:hover {
			background-color: #3e8e41;
		}

		#FormContainer {
			grid-area: form;
			width: 100%;
			padding: 20px;
			border: 1px solid #ccc;
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
			align-items: flex-start;
			border-radius: 8px;
			align-self: start;
			position: sticky;
			top: 20px;
			gap: 10px;
			min-height: 600px;
			transition: none;
		}

		/* Main content area - RIGHT COLUMN (Contains generated code, binary, and image) */
		#mainContainer {
			grid-area: main;
			display: flex;
			flex-direction: column; /* Stack all three vertically */
			align-items: stretch; /* Full width for child elements */
			box-sizing: border-box;
			width: 100%;
			gap: 15px; /* Space between all sections */
			padding: 15px;
			border: 1px solid #ccc;
			border-radius: 8px;
		}

		/* Unified title styling for all sections */
		#generatedCode h3,
		#oneDCodeSection h3,
		#binaryCodeSection h3,
		#fullBoxCodeSection h3, 
		#productImageSection h3 {
			margin-top: 0;
			margin-bottom: 15px;
			font-size: 18px;           /* Larger font */
			color: #007bff;            /* Blue color */
			font-weight: 600;          /* Semi-bold */
			text-align: center;        /* Center align */
			border-bottom: 2px solid #007bff; /* Underline */
			padding-bottom: 5px;       /* Space above border */
		}

		/* 1D Code section - positioned next to 2D Matrix code */
		#oneDCodeSection {
			width: 100%;
			padding: 15px;
			border: 1px solid #ddd;    /* Add this line */
			border-radius: 6px;        /* Add this line */
			box-sizing: border-box;
			text-align: left;
			grid-column: 2;
			grid-row: 1;
		}

		/* Full Box Code section - positioned next to RFID code */
		#fullBoxCodeSection {
			width: 100%;
			padding: 15px;
			border: 1px solid #ddd;    /* Add this line */
			border-radius: 6px;        /* Add this line */
			box-sizing: border-box;
			text-align: left;
			grid-column: 2;
			grid-row: 2;
		}



		/* Update main container to use grid layout for side-by-side positioning */
		#mainContainer {
			grid-area: main;
			display: grid;
			grid-template-columns: 1fr 1fr; /* Two columns */
			grid-template-rows: auto auto auto; /* Three rows */
			gap: 15px;
			box-sizing: border-box;
			width: 100%;
			padding: 15px;
			border: 1px solid #ccc;
			border-radius: 8px;
		}

		/* Update existing sections for grid positioning */
		#generatedCode {
			grid-column: 1;
			grid-row: 1;
			width: 100%;
			padding: 15px;
			border: 1px solid #ddd;
			border-radius: 6px;
			box-sizing: border-box;
		}

		#oneDCodeSection {
			grid-column: 2;
			grid-row: 1;
		}

		#binaryCodeSection {
			grid-column: 1;
			grid-row: 2;
			width: 100%;
			padding: 15px;
			border: 1px solid #ddd;
			border-radius: 6px;
			box-sizing: border-box;
			text-align: left;
		}

		#fullBoxCodeSection {
			grid-column: 2;
			grid-row: 2;
		}

		#productImageSection {
			grid-column: 1 / -1; /* Span both columns */
			grid-row: 3;
			width: 100%;
			text-align: center;
			box-sizing: border-box;
			padding: 15px;
			border: 1px solid #ddd;
			border-radius: 6px;
		}


		#copyright {
			position: fixed;
			bottom: 10px;
			right: 10px;
			font-size: 12px;
			color: #666;
			padding: 5px;
			background-color: rgba(255, 255, 255, 0.7);
			border-radius: 3px;
			z-index: 1000;
		}

		/* Input and form styling */
		.input-group {
			width: 100%;
			margin-bottom: 10px;
			display: flex;
			flex-direction: column;
			align-items: flex-start;
		}

		label {
			display: block;
			margin-bottom: 5px;
			font-weight: bold;
			text-align: left;
			width: 100%;
		}

		input[type="text"], 
		input[type="number"] {
			padding: 8px;
			font-size: 16px;
			border: 1px solid #ccc;
			border-radius: 4px;
			width: 100%;
			box-sizing: border-box;
		}

		.hidden-label {
			display: none;
		}

		.hidden {
			display: none;
		}

		.serial-container {
			width: 100%;
			display: flex;
			align-items: center;
		}

				/* Unified barcode styling */
		#barcodeImage,
		#oneDBarcode,
		#fullBoxBarcode {
			text-align: center;
			margin-top: 10px;
			min-height: 150px;
			display: flex;  /* ADD THIS */
			align-items: center;  /* ADD THIS */
			justify-content: center;  /* ADD THIS */
		}

		#barcodeImage canvas,
		#oneDBarcode canvas,
		#fullBoxBarcode canvas {
			border: 1px solid #ccc;
			padding: 10px;
			background-color: white;
			border-radius: 4px;
			display: block;
			margin: 0 auto; /* Center the canvas */
		}


		/* Section titles styling */
		#codeTitle {
			font-size: 24px;
			color: #8e44ad;           /* Purple */
			font-style: italic;
			text-decoration: underline;
			font-weight: bold;
		}

		#codeResult,
		#oneDResult,
		#binaryResult,
		#fullBoxResult {
			font-size: 24px;           /* Increased from default ~12-14px */
			font-weight: bold;         /* Make it bold */
			font-family: 'Louis Vuitton', monospace;  /* Monospace for code */
			line-height: 1.6;          /* Better spacing */
			word-wrap: break-word;     /* Prevent overflow */
			padding-right: 10px;       /* Space before Copy button */
			flex: 1;                   /* Take available space */
		}
		
		.code-result-container {
			display: flex;
			align-items: center;
			gap: 15px;                 /* Space between code and button */
			margin-bottom: 15px;
			flex-wrap: nowrap;         /* Keep on same line */
		}

		.code-result-container > div {
			flex: 1;                   /* Code text takes remaining space */
			min-width: 0;              /* Allow text to shrink if needed */
		}

		.code-result-container > button {
			flex-shrink: 0;            /* Button stays same size */
		}



		#productTitle {
			font-size: 18px;
			color: #8e44ad;           /* Purple */
			font-style: italic;
			text-decoration: underline;
		}

		
		#productImageSection h4{
			max-width: 70%;
			height: auto;
			aspect-ratio: 21 / 7;
			border-radius: 4px;
			object-fit: contain;
			object-position: center;
			margin: 0 auto;
			display: block;
			}

		/* Responsive design */
		@media (max-width: 1200px) {
			body {
				grid-template-areas: 
					"header"
					"form"
					"main";
				grid-template-columns: 1fr;
				grid-template-rows: auto auto 1fr;
				gap: 20px;
			}
			
			#FormContainer {
				position: static;
			}
		}

		/* Mobile responsive design */
		@media (max-width: 768px) {
			body {
				grid-template-areas: 
					"header"
					"form"  
					"main";
				grid-template-columns: 1fr;
				grid-template-rows: auto auto 1fr;
				padding: 10px;
			}
			
			#FormContainer {
				position: static;
			}
			
			#mainContainer {
				flex-direction: column;
			}

			#generatedCode,
			#binaryCodeSection,
			#productImageSection {
				width: 100%;
			}
		}

		.close-button {
			position: absolute;
			top: 10px;
			right: 15px;
			background: rgba(255,255,255,0.2);
			color: white;
			border: none;
			font-size: 24px;
			cursor: pointer;
			padding: 5px 10px;
			border-radius: 50%;
			font-weight: bold;
			transition: background 0.2s ease;
		}

		.close-button:hover {
			background: rgba(255,255,255,0.3);
			transform: scale(1.1);
		}

			@media (max-width: 768px) {
			#mainContainer {
				grid-template-columns: 1fr; /* Single column on mobile */
				grid-template-rows: auto auto auto auto auto; /* Five rows */
			}
			
			#generatedCode {
				grid-column: 1;
				grid-row: 1;
			}
			
			#oneDCodeSection {
				grid-column: 1;
				grid-row: 2;
			}
			
			#binaryCodeSection {
				grid-column: 1;
				grid-row: 3;
			}
			
			#fullBoxCodeSection {
				grid-column: 1;
				grid-row: 4;
			}
			
			#productImageSection {
				grid-column: 1;
				grid-row: 5;
			}
		}
			
			.mode-switcher {
			grid-area: mode;  /* ADD THIS */
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
			margin: 20;
			padding: 10px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-radius: 5px;  /* CHANGED from 15px to match button */
			box-shadow: 0 8px 5px rgba(0,0,0,0.2);
			color: white;
			max-width: 100%;  /* ADD THIS */
			box-sizing: border-box;  /* ADD THIS */
		}


			.toggle-container {
				position: left-side;
			}

			.toggle-checkbox {
				display: none;
			}

			.toggle-label {
				display: block;
				width: 80px;
				height: 40px;
				background: rgba(255,255,255,0.2);
				border-radius: 25px;
				cursor: pointer;
				transition: all 0.3s ease;
				position: relative;
				border: 2px solid rgba(255,255,255,0.3);
			}

			.toggle-label:hover {
				background: rgba(255,255,255,0.3);
				transform: scale(1.05);
			}

			.toggle-slider {
				position: absolute;
				top: 2px;
				left: 2px;
				width: 34px;
				height: 34px;
				background: white;
				border-radius: 50%;
				transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
				display: flex;
				align-items: center;
				justify-content: center;
				box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			}

			.toggle-icon {
				font-size: 16px;
				position: absolute;
				transition: all 0.3s ease;
			}

			.toggle-icon-left {
				opacity: 1;
				transform: scale(1);
			}

			.toggle-icon-right {
				opacity: 0;
				transform: scale(0.5);
			}

			.toggle-checkbox:checked + .toggle-label .toggle-slider {
				transform: translateX(40px);
				background: linear-gradient(135deg, #4CAF50, #45a049);
			}

			.toggle-checkbox:checked + .toggle-label .toggle-icon-left {
				opacity: 0;
				transform: scale(0.5);
			}

			.toggle-checkbox:checked + .toggle-label .toggle-icon-right {
				opacity: 1;
				transform: scale(1);
			}

			.toggle-checkbox:checked + .toggle-label {
				background: rgba(76, 175, 80, 0.3);
				border-color: rgba(76, 175, 80, 0.5);
			}

			.mode-info {
				display: flex;
				flex-direction: column;
				gap: 5px;
			}

			.mode-text {
				font-size: 18px;
				font-weight: 600;
				text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
			}

			.mode-description {
				font-size: 14px;
				opacity: 0.9;
				font-style: italic;
			}

			/* Error styling for code inputs */
			.code-input-error {
				border: 2px solid #ff4444 !important;
				background-color: #ffe6e6 !important;
				animation: shake 0.5s ease-in-out;
			}

			.code-input-disabled {
				opacity: 0.3 !important;
				pointer-events: none !important;
				background-color: #f0f0f0 !important;
				border-color: #ddd !important;
			}

			.error-message {
				color: #ff4444;
				font-size: 12px;
				margin-top: 5px;
				font-weight: bold;
				display: none;
			}

			@keyframes shake {
				0%, 100% { transform: translateX(0); }
				25% { transform: translateX(-5px); }
				75% { transform: translateX(5px); }
			}

			/* Active code input highlight */
			.code-input-active {
				border: 2px solid #4CAF50 !important;
				background-color: #f0fff0 !important;
				box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
			}

					}
		
		.generate-section > button,
		#FormContainer > button:last-child {
			font-size: 24px !important;   
			padding: 20px 40px !important;
			background-color: #4CAF50 !important;
			color: white !important;
			border: none !important;
			cursor: pointer !important;
			border-radius: 5px !important;
			margin-top: 0px !important;   
			width: auto !important;
			box-sizing: border-box !important;
			min-height: 60px !important;  
			display: inline-flex !important;
			align-items: center !important;
			justify-content: center !important;
			text-align: center !important;
		}


		.generate-section > button:hover,
		#FormContainer > button:last-child:hover {
			background-color: #3e8e41 !important;
		}

		/* Keep utility buttons unchanged - override any accidental styling */
		.utility-button {
			font-size: 14px !important;
			padding: 10px 18px !important;
			color: white !important;
			border: none !important;
			cursor: pointer !important;
			border-radius: 4px !important;
			margin-right: 10px !important;
			margin-bottom: 10px !important;
			width: auto !important;
			min-height: auto !important;
			display: inline-block !important;
			margin-left: 15px !important;    /* Add space to the left */
			margin-top: 10px !important;     /* Add space above */
		}

		.utility-button:hover {
			background-color: #0056b3 !important;
		}
		
		button:focus,
			.utility-button:focus {
			outline: none !important;
			border: none !important;
			box-shadow: none !important;
		}

		/* Typewriter cursor animation */
		@keyframes blink-cursor {
			0%, 49% { opacity: 1; }
			50%, 100% { opacity: 0; }
		}

		.typing-cursor {
			display: inline-block;
			width: 2px;
			height: 1em;
			background-color: #333;
			margin-left: 2px;
			animation: blink-cursor 1s infinite;
		}


</style>

</head>
<body>
    
		<div class="generate-section">
		<div class="mode-switcher">
			<div class="toggle-container">
				<input type="checkbox" id="modeToggle" class="toggle-checkbox">
				<label for="modeToggle" class="toggle-label">
					<span class="toggle-slider">
						<span class="toggle-icon toggle-icon-left">📊</span>
						<span class="toggle-icon toggle-icon-right">🔍</span>
					</span>
				</label>
			</div>
			<div class="mode-info">
				<span id="modeLabel" class="mode-text">Input Mode: Product Data → Codes</span>
			</div>
		</div>
		</div>

		<div id="FormContainer">
        <div class="serial-container">
            <div class="input-group">
                <label for="serial" class="hidden-label">Serial (13-14 chars):</label>
                <input type="text" id="serial" name="serial" maxlength="14">
                <button type="button" class="utility-button" onclick="focusSerial()">Edit Serial</button>
            </div>
        </div>
         <div class="utility-buttons">
            <button class="utility-button" onclick="resetToDefaults()">Reset to Default Values</button>
            <button class="utility-button" onclick="clearAllFields()">Clear All Fields</button>
        </div>

        <div class="input-group">
            <label for="shortSku">ShortSKU (6 chars):</label>
            <input type="text" id="shortSku" name="shortSku" maxlength="6">
        </div>
        
        <div class="input-group">
            <label for="quantity">Quantity (4 digits):</label>
            <input type="number" id="quantity" name="quantity" min="0" max="9999">
        </div>
        
        <div class="input-group">
            <label for="madeIn">Made IN (2 chars):</label>
            <input type="text" id="madeIn" name="madeIn" maxlength="2">
        </div>
        
        <div class="input-group">
            <label for="supplierId">Supplier ID (30 chars):</label>
            <input type="text" id="supplierId" name="supplierId" maxlength="30">
        </div>
        
        <div class="input-group">
            <label for="batch">Batch (3-17 chars):</label>
            <input type="text" id="batch" name="batch" minlength="3" maxlength="17">
        </div>
        
        <div class="input-group">
            <label for="originPref">Origin Pref (3-17 chars):</label>
            <input type="text" id="originPref" name="originPref" minlength="3" maxlength="17">
        </div>
		
			<div id="codeInputSection" class="hidden">
		<h3>Code Input Mode</h3>
		
		<div class="input-group">
			<label for="rfidCodeInput">RFID Code:</label>
			<input type="text" id="rfidCodeInput" name="rfidCodeInput">
		</div>
		
		<div class="input-group">
			<label for="oneDCodeInput">1D Code:</label>
			<input type="text" id="oneDCodeInput" name="oneDCodeInput">
		</div>
		
		<div class="input-group">
			<label for="fullBoxCodeInput">Full Box Code (GS1):</label>
			<input type="text" id="fullBoxCodeInput" name="fullBoxCodeInput">
		</div>
		
		<div class="input-group">
			<label for="matrixCodeInput">2D Matrix Code:</label>
			<input type="text" id="matrixCodeInput" name="matrixCodeInput">
		</div>
	</div>

        
 </div>
		
		<button onclick="generateCodeEnhanced()">Generate Code</button>
    
			 <div id=mainContainer>
		<!-- 2D Matrix Code (top-left) -->
		<div id=generatedCode>
			<h3>2D Data Matrix code PCE</h3>
			<div class=code-result-container>
				<div id=codeResult></div>
				<button id=copyButton class=utility-button>Copy</button>
			</div>
			<div id=barcodeImage></div>
		</div>

		
		<!-- 1D Code (top-right) -->
		<div id=oneDCodeSection>
			<h3>1D Code</h3>
			<div class=code-result-container>
				<div id=oneDResult></div>
				<button id=copyOneDButton class=utility-button>Copy</button>
			</div>
			<div id=oneDBarcode></div>
		</div>
		
		<!-- RFID Code (middle-left) -->
		<div id=binaryCodeSection>
			<h3>RFID code</h3>
			<div class=code-result-container>
				<div id=binaryResult></div>
				<button id=copyBinaryButton class=utility-button>Copy</button>
			</div>
		</div>

		<!-- Full Box Code (middle-right) -->
		<div id=fullBoxCodeSection>
			<h3>Full Box Code (GS1)</h3>
			<div class=code-result-container>
				<div id=fullBoxResult></div>
				<button id=copyFullBoxButton class=utility-button>Copy</button>
			</div>
			<div id=fullBoxBarcode></div>
		</div>

		<!-- Product Image (bottom, spans both columns) -->
		<div id=productImageSection>
			<h3>Product Image</h3>
			<a id=productImageLink href=# target=_blank>
				<img id=productImage src= alt=Product Image>
			</a>
		</div>
	</div>

	  	
	<div id="copyright">
    &copy; Nikita Astafiev. All rights reserved V.1.3
	</div>



</body>



<script>

let currentShortSku = '';

function updateProductImage() {
    const shortSkuValue = document.getElementById('shortSku').value;
    const imageSection = document.getElementById('productImageSection');
    
	   // Show the regular Louis Vuitton product image
        const imageUrl = `https://fr.louisvuitton.com/images/is/image/lv/1/PP_VP_AS/louis-vuitton--${shortSkuValue}_PM2_Front%20view.jpg?wid=400&amp;hei=400`;
        
        // Update the image and link
        document.getElementById('productImage').src = imageUrl;
        document.getElementById('productImageLink').href = imageUrl;
        
        // Position the image section under the generated code
        imageSection.style.top = '270px';
        
        // Show the image section
        imageSection.style.display = 'block';
        
        // Update the current SKU
        currentShortSku = shortSkuValue;
        currentShortSku = '';
    //}
}




    let counter = 0; // Initialize counter
    let serialOverride = false;

    function resetToDefaults() {
        document.getElementById('shortSku').value = 'M41414';
        document.getElementById('quantity').value = '0010';
        document.getElementById('madeIn').value = 'US';
        document.getElementById('supplierId').value = '130';
        document.getElementById('batch').value = 'FR';
        document.getElementById('originPref').value = 'UE';
        serialOverride = false; // Allow auto-generation of serial again
        generateCode();
    }
    
    function clearAllFields() {
        document.getElementById('serial').value = '';
        document.getElementById('shortSku').value = '';
        document.getElementById('quantity').value = '';
        document.getElementById('madeIn').value = '';
        document.getElementById('supplierId').value = '';
        document.getElementById('batch').value = '';
        document.getElementById('originPref').value = '';
        serialOverride = false; // Prevent auto-generation of serial
        generateCode();
    }
	
	function focusSerial() {
    const serialInput = document.getElementById('serial');
    serialInput.focus();
    
    // Optional: select all text in the field to make it easy to replace
    serialInput.select();
	}

// Binary converter functions from version01.html
function convertCharWithTable(char, table) {
    var decimal = table[char] || 63;
    var bin6 = decimal.toString(2).padStart(6, '0');
    var binaryValue = parseInt(bin6, 2);
    var adjusted = binaryValue - 1;
    var finalBinary = adjusted.toString(2).padStart(6, '0');
    return {
        decimal: decimal,
        binaryFirst: bin6,
        adjusted: adjusted,
        binary: finalBinary
    };
}

function generateBinaryCode() {
    // Get values from the existing form fields
    var param1 = document.getElementById('serial').value.toUpperCase(); // Serial
    var param2 = document.getElementById('shortSku').value.toUpperCase(); // ShortSKU
    var param3 = document.getElementById('quantity').value.trim(); // Quantity
    var param4 = document.getElementById('madeIn').value.toUpperCase(); // Made IN
    
    // Character table from version01.html
    var table = {
        '0': 1, '1': 2, '2': 3, '3': 4, '4': 5, '5': 6, '6': 7, '7': 8, '8': 9, '9': 10,
        'A': 18, 'B': 19, 'C': 20, 'D': 21, 'E': 22, 'F': 23, 'G': 24, 'H': 25, 'I': 26,
        'J': 34, 'K': 35, 'L': 36, 'M': 37, 'N': 38, 'O': 39, 'P': 40, 'Q': 41, 'R': 42,
        'S': 51, 'T': 52, 'U': 53, 'V': 54, 'W': 55, 'X': 56, 'Y': 57, 'Z': 58, '[': 11,
        '#': 12, '@': 13, ':': 14, '>': 15, '?': 16, ' ': 17, '.': 28, ']': 29, '(': 30,
        '<': 31, '^': 33, '-': 43, '$': 44, '*': 45, ')': 46, ';': 47, '/': 50, ',': 60, 
        '%': 61, '=': 62, '': 63, '!': 64 
    };

    // Start with 0000
    var binary = '0000';
    var details = '<h4>Conversion Process:</h4>';
    details += 'Step 1: Fixed prefix = <span class=binary-group>0000</span><br><br>';

    // Process Parameter 1 (Serial)
    if (param1) {
        // Process first 2 characters with table (decimal-1 rule)
        for (var i = 0; i < 2 && i < param1.length; i++) {
            var char = param1[i];
            var result = convertCharWithTable(char, table);
            binary += result.binary;
        }


         // Process remaining characters as digits (direct 4-bit conversion)
        for (var i = 2; i < param1.length; i++) {
            var digit = param1[i];
            if (digit >= '0' && digit <= '9') {
                var bin4 = parseInt(digit).toString(2).padStart(4, '0');
                binary += bin4;
            }
        }
    }


    // Process Parameter 2 (ShortSKU)
    if (param2) {
        for (var i = 0; i < param2.length && i < 6; i++) {
            var char = param2[i];
            var result = convertCharWithTable(char, table);
            binary += result.binary;
        }
    }


    // Process Parameter 3 (Quantity)
    if (param3) {
        var number = parseInt(param3);
        if (!isNaN(number)) {
            var numberBinary = number.toString(2);
            var paddedBinary = numberBinary.padStart(12, '0');
            binary += paddedBinary;
        }
    }

    // Process Parameter 4 (Made IN)
    if (param4) {
        for (var i = 0; i < param4.length && i < 2; i++) {
            var char = param4[i];
            var result = convertCharWithTable(char, table);
            binary += result.binary;
        }
    }


    // Add final 0000
    binary += '0000';

    // Convert to hexadecimal
    var hexResult = '';
    var hexDetails = '<strong>Hexadecimal Conversion:</strong><br>';
    
    for (var i = 0; i < binary.length; i += 4) {
        var fourBits = binary.substr(i, 4);
        var hexDigit = parseInt(fourBits, 2).toString(16).toUpperCase();
        hexResult += hexDigit;
    }

    
    // Add final dash
    var finalResult = hexResult + '-';

    // Format binary output in groups of 4
    var formatted = '';
    for (var i = 0; i < binary.length; i += 4) {
        formatted += '<span class=binary-group>' + binary.substr(i, 4) + '</span> ';
    }

    // Display results in the binary section
    // Create the div first
	const binaryResultDiv = document.getElementById('binaryResult');
	binaryResultDiv.innerHTML = '<div class="hex-result"></div>';

	// Then apply typewriter effect to it
	const hexResultDiv = binaryResultDiv.querySelector('.hex-result');
	typewriterEffect(hexResultDiv, finalResult, 5);


    // Show the binary code section
    document.getElementById('binaryCodeSection').style.display = 'block';
     
}

	// Generate 1D Code (updated barcode section)
function generateOneDCode() {
    const quantityValue = document.getElementById('quantity').value;
    const shortSkuValue = document.getElementById('shortSku').value;
    
    if (quantityValue && shortSkuValue) {
        // Divide quantity by 10 and pad to 4 digits
        const quantityNum = parseInt(quantityValue) || 0;
        const dividedQuantity = Math.floor(quantityNum / 10);
        const paddedQuantity = dividedQuantity.toString().padStart(4, '0');
        
        const oneDCode = paddedQuantity + shortSkuValue;
        
        typewriterEffect(document.getElementById('oneDResult'), oneDCode, 5);

        
        // Generate 1D barcode (Code 128) with consistent styling
        const oneDBarcodeDiv = document.getElementById('oneDBarcode');
        oneDBarcodeDiv.innerHTML = '';
        
        const canvas = document.createElement('canvas');
        oneDBarcodeDiv.appendChild(canvas);
        
        try {
            bwipjs.toCanvas(canvas, {
                bcid: 'code128',
                text: oneDCode,
                scale: 1.5,        // Same scale as 2D code
                height: 15,
                includetext: false, // Same as 2D code
                textxalign: 'center'
            });
        } catch (e) {
            oneDBarcodeDiv.innerHTML = 'Error generating 1D barcode: ' + e;
        }
    } else {
        document.getElementById('oneDResult').innerText = '';
        document.getElementById('oneDBarcode').innerHTML = '';
    }
}

// Generate Full Box Code (updated barcode section)
function generateFullBoxCode() {
    const serialValue = document.getElementById('serial').value;
    const quantityValue = document.getElementById('quantity').value;
    const shortSkuValue = document.getElementById('shortSku').value;
    const batchValue = document.getElementById('batch').value;
    const originPrefValue = document.getElementById('originPref').value;
    const madeInValue = document.getElementById('madeIn').value;
    
    if (serialValue && quantityValue && shortSkuValue && batchValue && originPrefValue && madeInValue) {
        const quantityNum = parseInt(quantityValue) || 0;
        const dividedQuantity = Math.floor(quantityNum / 10);
        const paddedQuantity = dividedQuantity.toString().padStart(4, '0');
        
        const fullBoxCode = `91${serialValue}_37${paddedQuantity}_241${shortSkuValue}_10${batchValue}_94${originPrefValue}_93${madeInValue}`;
        
        typewriterEffect(document.getElementById('fullBoxResult'), fullBoxCode, 5);

        
        // Generate Code 128 barcode with consistent styling
        const fullBoxBarcodeDiv = document.getElementById('fullBoxBarcode');
        fullBoxBarcodeDiv.innerHTML = '';
        
        const canvas = document.createElement('canvas');
        fullBoxBarcodeDiv.appendChild(canvas);
        
        try {
            bwipjs.toCanvas(canvas, {
                bcid: 'code128',
                text: fullBoxCode,
                scale: 1.2,        // Slightly smaller than others due to longer text
                height: 15,
                includetext: false, // Same as 2D code
                textxalign: 'center'
            });
        } catch (e) {
            fullBoxBarcodeDiv.innerHTML = 'Error generating Full Box barcode: ' + e;
        }
    } else {
        document.getElementById('fullBoxResult').innerText = '';
        document.getElementById('fullBoxBarcode').innerHTML = '';
    }
}



    function generateCode() {
        const serialInput = document.getElementById('serial');
        const shortSkuInput = document.getElementById('shortSku');
        const quantityInput = document.getElementById('quantity');
        const madeInInput = document.getElementById('madeIn');
        const supplierIdInput = document.getElementById('supplierId');
        const batchInput = document.getElementById('batch');
        const originPrefInput = document.getElementById('originPref');

		// Force currentShortSKU to reset so we recalculate completely
		currentShortSku = '';

		// Update the product image based on ShortSKU
		updateProductImage();
	
        // Serial generation logic
        if (!serialOverride) {
            counter++;
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${year}${month}${day}`;
            const formattedCounter = String(counter).padStart(4, '0');
            const serialValue = `FR${formattedDate}${formattedCounter}`;
            serialInput.value = serialValue;
        }
		
		// Serial generation logic
		if (!serialOverride && serialInput.value === '') {
			counter++;
			const today = new Date();
			const year = today.getFullYear();
			const month = String(today.getMonth() + 1).padStart(2, '0');
			const day = String(today.getDate()).padStart(2, '0');
			const formattedDate = `${year}${month}${day}`;
			const formattedCounter = String(counter).padStart(4, '0');
			serialInput.value = `FR${formattedDate}${formattedCounter}`;
		}



			// Show Labels by removing the class
			const labels = document.querySelectorAll('label');
			labels.forEach(label => {
				if (label.htmlFor !== 'serial') {
					label.classList.remove('hidden-label');
				}
			});

			//Show Generated code results by removing the class
			const generatedCodeDiv = document.getElementById('generatedCode');
			generatedCodeDiv.classList.remove('hidden');
				
			const quantityValue = quantityInput.value;
			const shortSkuValue = shortSkuInput.value;
			const supplierIdValue = supplierIdInput.value;
			const madeInValue = madeInInput.value;
			const originPrefValue = originPrefInput.value;
			const batchValue = batchInput.value;

			const code = `0_${serialInput.value}_${quantityValue}_${shortSkuValue}__${supplierIdValue}_${madeInValue}_${originPrefValue}_${batchValue}`;

			// Use typewriter effect for the main code
			typewriterEffect(document.getElementById('codeResult'), code, 5);
			
			// Clear previous barcode
			const barcodeDiv = document.getElementById('barcodeImage');
			barcodeDiv.innerHTML = '';

			// Create canvas for the barcode
			const canvas = document.createElement('canvas');
			barcodeDiv.appendChild(canvas);

			// Generate Data Matrix barcode
			try {
				bwipjs.toCanvas(canvas, {
					bcid: 'datamatrix',
					text: code,
					scale: 1.5,
					height: 25,
					includetext: false,
					textxalign: 'center'
				});
			} catch (e) {
				barcodeDiv.innerHTML = 'Error generating barcode: ' + e;
			}
		

			// Generate binary code too
			generateBinaryCode();
			// Generate 1D code
			generateOneDCode();

			// Generate Full Box code
			generateFullBoxCode();
	}

    window.onload = function () {

        const serialInput = document.getElementById('serial');
        const shortSkuInput = document.getElementById('shortSku');
        const quantityInput = document.getElementById('quantity');
        const madeInInput = document.getElementById('madeIn');
        const supplierIdInput = document.getElementById('supplierId');
        const batchInput = document.getElementById('batch');
        const originPrefInput = document.getElementById('originPref');
		
	// Track manual serial edits
			serialInput.addEventListener('input', () => {
		if (serialInput.value !== '') {
			serialOverride = true;
		}
	});

		
		
		 // Set up the initial product image if ShortSKU has a value
    updateProductImage();
    
    // Optional: Add event listener to automatically update when ShortSKU changes
    document.getElementById('shortSku').addEventListener('change', function() {
        // Only update if we're not in the middle of generating a code
        if (!document.activeElement || document.activeElement.id !== 'shortSku') {
            updateProductImage();
        }
    });



        // Set initial default values directly
        shortSkuInput.value = 'M41414';
        quantityInput.value = '0010';
        madeInInput.value = 'US';
        supplierIdInput.value = '130';
        batchInput.value = 'FR';
        originPrefInput.value = 'UE';

        generateCode(); // Generate initial code with default values
    };
	

// Function to copy the generated code to clipboard
document.getElementById('copyButton').addEventListener('click', function() {
    const codeText = document.getElementById('codeResult').innerText;
    
    // Use modern Clipboard API if available
    if (navigator.clipboard) {
        navigator.clipboard.writeText(codeText).then(() => {
            // Provide visual feedback that copy succeeded
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            // Return to original state after 1.5 seconds
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        }).catch(err => {
            console.error('Copy failed:', err);
            alert('Copy failed. ' + err);
        });
    } else {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = codeText;
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            document.execCommand('copy');
            // Provide visual feedback
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        } catch (err) {
            console.error('Copy failed:', err);
            alert('Copy failed');
        }
        
        document.body.removeChild(textarea);
    }});

	// Copy button for binary code
document.getElementById('copyBinaryButton').addEventListener('click', function() {
    const binaryText = document.getElementById('binaryResult').innerText;
    
    // Use modern Clipboard API if available
    if (navigator.clipboard) {
        navigator.clipboard.writeText(binaryText).then(() => {
            // Provide visual feedback that copy succeeded
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            // Return to original state after 1.5 seconds
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        }).catch(err => {
            console.error('Copy failed:', err);
            alert('Copy failed. ' + err);
        });
    } else {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = binaryText;
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            document.execCommand('copy');
            // Provide visual feedback
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        } catch (err) {
            console.error('Copy failed:', err);
            alert('Copy failed');
        }
        
        document.body.removeChild(textarea);
    }
});

		// Copy button for 1D code
document.getElementById('copyOneDButton').addEventListener('click', function() {
    const oneDText = document.getElementById('oneDResult').innerText;
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(oneDText).then(() => {
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        }).catch(err => {
            console.error('Copy failed:', err);
            alert('Copy failed. ' + err);
        });
    } else {
        const textarea = document.createElement('textarea');
        textarea.value = oneDText;
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            document.execCommand('copy');
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        } catch (err) {
            console.error('Copy failed:', err);
            alert('Copy failed');
        }
        
        document.body.removeChild(textarea);
    }
});

// Copy button for Full Box code
document.getElementById('copyFullBoxButton').addEventListener('click', function() {
    const fullBoxText = document.getElementById('fullBoxResult').innerText;
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(fullBoxText).then(() => {
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        }).catch(err => {
            console.error('Copy failed:', err);
            alert('Copy failed. ' + err);
        });
    } else {
        const textarea = document.createElement('textarea');
        textarea.value = fullBoxText;
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            document.execCommand('copy');
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        } catch (err) {
            console.error('Copy failed:', err);
            alert('Copy failed');
        }
        
        document.body.removeChild(textarea);
    }
});

	let isReverseMode = false;

// Mode switcher functionality
document.getElementById('modeToggle').addEventListener('change', function() {
    isReverseMode = this.checked;
    toggleMode();
});

function toggleMode() {
    const productInputSection = document.getElementById('FormContainer');
    const modeLabel = document.getElementById('modeLabel');
    const mainContainer = document.getElementById('mainContainer');
    const generateButtons = document.querySelectorAll('button');
    
    if (isReverseMode) {
        // Switch to reverse mode - convert result divs to input fields
        productInputSection.style.opacity = '0.5';  /* CHANGE from classList.add */
        productInputSection.style.pointerEvents = 'none';  /* ADD THIS */
        mainContainer.classList.add('reverse-mode');
        modeLabel.textContent = 'Input Mode: Codes → Product Data';
        
        // Change button text
        generateButtons.forEach(button => {
            if (button.textContent.includes('Generate code') || button.textContent.includes('Generate Code')) {
                button.textContent = 'Parse Codes';
            }
        });
        
        // Convert result divs to input fields by replacing their content
        replaceWithInput('codeResult', 'Paste 2D Matrix code here...');
        replaceWithInput('oneDResult', 'Paste 1D code here...');
        replaceWithInput('binaryResult', 'Paste RFID code here...');
        replaceWithInput('fullBoxResult', 'Paste Full Box code here...');
        
        // Hide barcodes
        hideElement('barcodeImage');
        hideElement('oneDBarcode');
        hideElement('fullBoxBarcode');
        
        // Make product data fields visually disabled but still allow programmatic updates
        makeFieldsVisuallyDisabled();
        
    } else {
        // Switch to normal mode - restore original divs
        productInputSection.style.opacity = '1';  /* CHANGE from classList.remove */
        productInputSection.style.pointerEvents = 'auto';  /* ADD THIS */
        mainContainer.classList.remove('reverse-mode');
        modeLabel.textContent = 'Input Mode: Product Data → Codes';
        
        // Change button text back
        generateButtons.forEach(button => {
            if (button.textContent.includes('Parse Codes')) {
                button.textContent = 'Generate Code';
            }
        });
        
        // Restore original result divs
        restoreOriginalDiv('codeResult');
        restoreOriginalDiv('oneDResult');
        restoreOriginalDiv('binaryResult');
        restoreOriginalDiv('fullBoxResult');
        
        // Show barcodes
        showElement('barcodeImage');
        showElement('oneDBarcode');
        showElement('fullBoxBarcode');
        
        // Restore product data fields
        restoreFieldsNormal();
        
        // Regenerate codes with current data
        generateCode();
    }
}


function makeFieldsVisuallyDisabled() {
    const fields = ['serial', 'shortSku', 'quantity', 'madeIn', 'supplierId', 'batch', 'originPref'];
    
    fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            field.style.backgroundColor = '#f5f5f5';
            field.style.color = '#666';
            field.style.border = '1px solid #ddd';
            field.setAttribute('readonly', true);
        }
    });
}

function restoreFieldsNormal() {
    const fields = ['serial', 'shortSku', 'quantity', 'madeIn', 'supplierId', 'batch', 'originPref'];
    
    fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            field.style.backgroundColor = '';
            field.style.color = '';
            field.style.border = '';
            field.removeAttribute('readonly');
        }
    });
}

function replaceWithInput(elementId, placeholder) {
    const element = document.getElementById(elementId);
    if (element) {
        // Store original content and structure
        element.setAttribute('data-original-content', element.innerHTML);
        element.setAttribute('data-original-class', element.className);
        
        // Clear and replace with input
        element.innerHTML = '';
        element.className = element.className + ' code-input-container';
        element.style.padding = '8px';
        element.style.border = '2px solid #2196F3';
        element.style.borderRadius = '4px';
        element.style.backgroundColor = '#f0f8ff';
        element.style.minHeight = '60px';
        element.style.display = 'flex';
        element.style.alignItems = 'center';
        
        // Create input element
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'code-input';
        input.placeholder = placeholder;
        input.style.width = '100%';
        input.style.border = 'none';
        input.style.outline = 'none';
        input.style.backgroundColor = 'transparent';
        input.style.fontFamily = 'monospace';
        input.style.fontSize = '14px';
        input.style.minHeight = '40px';
        
        // ADD ENTER KEY LISTENER HERE
        input.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                
                // Visual feedback
                const originalBorder = element.style.border;
                element.style.border = '3px solid #4CAF50';
                
                setTimeout(() => {
                    element.style.border = originalBorder;
                }, 200);
                
                // Trigger parse codes
                console.log('Enter pressed in code input - Parsing codes...');
                parseCodestoProductData();
            }
        });
        
        element.appendChild(input);
    }
}


function restoreOriginalDiv(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        // Get the input value if it exists
        const input = element.querySelector('input');
        const inputValue = input ? input.value : '';
        
        // Restore original content and styling
        const originalContent = element.getAttribute('data-original-content') || '';
        const originalClass = element.getAttribute('data-original-class') || '';
        
        element.innerHTML = inputValue || originalContent;
        element.className = originalClass;
        
        // Reset inline styles
        element.style.padding = '';
        element.style.border = '';
        element.style.borderRadius = '';
        element.style.backgroundColor = '';
        
        // Remove data attributes
        element.removeAttribute('data-original-content');
        element.removeAttribute('data-original-class');
    }
}

function hideElement(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        element.style.visibility = 'hidden';  /* CHANGE from display to visibility */
        element.style.height = '150px';  /* MAINTAIN height */
    }
}

function showElement(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        element.style.visibility = 'visible';  /* CHANGE from display to visibility */
        element.style.height = '';  /* RESET height */
    }
}


// Enhanced generateCode function to handle both modes
function generateCodeEnhanced() {
    if (isReverseMode) {
        parseCodestoProductData();
    } else {
        generateCode(); // Your existing function
    }
}

// Get input value from converted div
function getInputValue(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        const input = element.querySelector('input');
        return input ? input.value.trim() : '';
    }
    return '';
}

// New function to parse codes back to product data
function parseCodestoProductData() {
    const matrixCode = getInputValue('codeResult');
    const oneDCode = getInputValue('oneDResult');
    const rfidCode = getInputValue('binaryResult');
    const fullBoxCode = getInputValue('fullBoxResult');
    
    console.log('Parsing codes:');
    console.log('Matrix:', matrixCode);
    console.log('1D:', oneDCode);
    console.log('RFID:', rfidCode);
    console.log('FullBox:', fullBoxCode);
    
    // Clear existing product data first
    clearProductData();
    
    let parsedAny = false;
    
    // Parse Matrix Code first (most complete data)
    if (matrixCode) {
        console.log('Attempting to parse Matrix code...');
        const success = parseMatrixCode(matrixCode);
        if (success) parsedAny = true;
    }
    
    // Parse Full Box Code (GS1 format) - only fill empty fields
    if (fullBoxCode) {
        console.log('Attempting to parse Full Box code...');
        const success = parseFullBoxCode(fullBoxCode);
        if (success) parsedAny = true;
    }
    
    // Parse 1D code (format: paddedQuantity + shortSku) - only fill empty fields
    if (oneDCode && oneDCode.length >= 4) {
        console.log('Attempting to parse 1D code...');
        const success = parseOneDCode(oneDCode);
        if (success) parsedAny = true;
    }
    
    // Parse RFID code (hex format ending with -)
    if (rfidCode) {
        console.log('Attempting to parse RFID code...');
        const success = parseRFIDCode(rfidCode);
        if (success) parsedAny = true;
    }
    
    if (parsedAny) {
        // Force update the product image after parsing
        setTimeout(() => {
            updateProductImage();
        }, 100);
        
        // Show success message
        alert('Codes parsed successfully! Product data has been populated in the form fields.');
        
        // Highlight the parsed fields briefly
        highlightParsedFields();
        
        // Log final values for debugging
        logCurrentValues();
    } else {
        alert('No valid codes found to parse. Please check your input codes.');
    }
}

function clearProductData() {
    const fields = ['serial', 'shortSku', 'quantity', 'madeIn', 'supplierId', 'batch', 'originPref'];
    
    fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            field.value = '';
        }
    });
}

function parseMatrixCode(matrixCode) {
    try {
        // Parse format: 0_{serial}_{quantity}_{shortSku}__{supplierId}_{madeIn}_{originPref}_{batch}
        const parts = matrixCode.split('_');
        console.log('Matrix parts:', parts);
        
        if (parts.length >= 8 && parts[0] === '0') {
            if (parts[1]) {
                document.getElementById('serial').value = parts[1];
                console.log('Set serial:', parts[1]);
            }
            if (parts[2]) {
                document.getElementById('quantity').value = parts[2];
                console.log('Set quantity:', parts[2]);
            }
            if (parts[3]) {
                document.getElementById('shortSku').value = parts[3];
                console.log('Set shortSku:', parts[3]);
            }
            if (parts[5]) {
                document.getElementById('supplierId').value = parts[5];
                console.log('Set supplierId:', parts[5]);
            }
            if (parts[6]) {
                document.getElementById('madeIn').value = parts[6];
                console.log('Set madeIn:', parts[6]);
            }
            if (parts[7]) {
                document.getElementById('originPref').value = parts[7];
                console.log('Set originPref:', parts[7]);
            }
            if (parts[8]) {
                document.getElementById('batch').value = parts[8];
                console.log('Set batch:', parts[8]);
            }
            
            console.log('Matrix code parsed successfully');
            return true;
        }
    } catch (e) {
        console.error('Error parsing Matrix code:', e);
    }
    return false;
}

function parseFullBoxCode(fullBoxCode) {
    try {
        // Parse GS1 format: 91{serial}_37{quantity}_241{shortSku}_10{batch}_94{originPref}_93{madeIn}
        const parts = fullBoxCode.split('_');
        console.log('FullBox parts:', parts);
        let parsed = false;
        
        parts.forEach(part => {
            if (part.startsWith('91') && !document.getElementById('serial').value) {
                const value = part.substring(2);
                document.getElementById('serial').value = value;
                console.log('Set serial from FullBox:', value);
                parsed = true;
            } else if (part.startsWith('37') && !document.getElementById('quantity').value) {
                const qty = parseInt(part.substring(2)) * 10;
                const value = qty.toString().padStart(4, '0');
                document.getElementById('quantity').value = value;
                console.log('Set quantity from FullBox:', value);
                parsed = true;
            } else if (part.startsWith('241') && !document.getElementById('shortSku').value) {
                const value = part.substring(3);
                document.getElementById('shortSku').value = value;
                console.log('Set shortSku from FullBox:', value);
                parsed = true;
            } else if (part.startsWith('10') && !document.getElementById('batch').value) {
                const value = part.substring(2);
                document.getElementById('batch').value = value;
                console.log('Set batch from FullBox:', value);
                parsed = true;
            } else if (part.startsWith('94') && !document.getElementById('originPref').value) {
                const value = part.substring(2);
                document.getElementById('originPref').value = value;
                console.log('Set originPref from FullBox:', value);
                parsed = true;
            } else if (part.startsWith('93') && !document.getElementById('madeIn').value) {
                const value = part.substring(2);
                document.getElementById('madeIn').value = value;
                console.log('Set madeIn from FullBox:', value);
                parsed = true;
            }
        });
        
        if (parsed) {
            console.log('Full Box code parsed successfully');
            return true;
        }
    } catch (e) {
        console.error('Error parsing Full Box code:', e);
    }
    return false;
}

function parseOneDCode(oneDCode) {
    try {
        // Parse format: paddedQuantity (4 digits) + shortSku (remaining chars)
        if (oneDCode.length >= 4) {
            const quantityPart = oneDCode.substring(0, 4);
            const shortSkuPart = oneDCode.substring(4);
            
            // Convert quantity (multiply by 10 since it was divided by 10)
            const quantity = parseInt(quantityPart) * 10;
            
            if (!document.getElementById('quantity').value) {
                const value = quantity.toString().padStart(4, '0');
                document.getElementById('quantity').value = value;
                console.log('Set quantity from 1D:', value);
            }
            if (!document.getElementById('shortSku').value && shortSkuPart) {
                document.getElementById('shortSku').value = shortSkuPart;
                console.log('Set shortSku from 1D:', shortSkuPart);
            }
            
            console.log('1D code parsed successfully');
            return true;
        }
    } catch (e) {
        console.error('Error parsing 1D code:', e);
    }
    return false;
}

function parseRFIDCode(rfidCode) {
    try {
        // Remove trailing dash if present
        const cleanCode = rfidCode.replace(/-$/, '');
        console.log('Parsing RFID cleanCode:', cleanCode);
        
        if (cleanCode.length === 0) {
            return false;
        }
        
        // Convert hex to binary
        let binary = '';
        for (let i = 0; i < cleanCode.length; i++) {
            const hex = cleanCode[i];
            const bin = parseInt(hex, 16).toString(2).padStart(4, '0');
            binary += bin;
        }
        
        console.log('RFID binary:', binary);
        
        // Character reverse lookup table
        const reverseTable = {
            1: '0', 2: '1', 3: '2', 4: '3', 5: '4', 6: '5', 7: '6', 8: '7', 9: '8', 10: '9',
            18: 'A', 19: 'B', 20: 'C', 21: 'D', 22: 'E', 23: 'F', 24: 'G', 25: 'H', 26: 'I',
            34: 'J', 35: 'K', 36: 'L', 37: 'M', 38: 'N', 39: 'O', 40: 'P', 41: 'Q', 42: 'R',
            51: 'S', 52: 'T', 53: 'U', 54: 'V', 55: 'W', 56: 'X', 57: 'Y', 58: 'Z', 11: '[',
            12: '#', 13: '@', 14: ':', 15: '>', 16: '?', 17: ' ', 28: '.', 29: ']', 30: '(',
            31: '<', 33: '^', 43: '-', 44: '$', 45: '*', 46: ')', 47: ';', 50: '/', 60: ',', 
            61: '%', 62: '=', 63: '', 64: '!'
        };
        
        let pos = 0;
        
        // Skip initial 0000
        pos += 4;
        
        // Parse Serial (first 2 chars with table lookup, then digits)
        let serial = '';
        
        // First 2 characters with table lookup (6 bits each, adjusted +1)
        for (let i = 0; i < 2 && pos + 6 <= binary.length; i++) {
            const sixBits = binary.substr(pos, 6);
            const decimal = parseInt(sixBits, 2) + 1; // Add 1 back (reverse of -1 in encoding)
            const char = reverseTable[decimal] || '?';
            serial += char;
            pos += 6;
            console.log(`Serial char ${i}: ${sixBits} -> ${decimal} -> ${char}`);
        }
        
        // Remaining characters as digits (4 bits each)
        while (pos + 4 <= binary.length && serial.length < 14) {
            const fourBits = binary.substr(pos, 4);
            const digit = parseInt(fourBits, 2);
            if (digit >= 0 && digit <= 9) {
                serial += digit.toString();
                pos += 4;
                console.log(`Serial digit: ${fourBits} -> ${digit}`);
            } else {
                break; // Stop if we encounter non-digit
            }
        }
        
        // Parse ShortSKU (6 characters with table lookup, 6 bits each)
        let shortSku = '';
        for (let i = 0; i < 6 && pos + 6 <= binary.length; i++) {
            const sixBits = binary.substr(pos, 6);
            const decimal = parseInt(sixBits, 2) + 1; // Add 1 back
            const char = reverseTable[decimal] || '?';
            shortSku += char;
            pos += 6;
            console.log(`ShortSKU char ${i}: ${sixBits} -> ${decimal} -> ${char}`);
        }
        
        // Parse Quantity (12 bits)
        let quantity = '';
        if (pos + 12 <= binary.length) {
            const twelveBits = binary.substr(pos, 12);
            const number = parseInt(twelveBits, 2);
            quantity = number.toString().padStart(4, '0');
            pos += 12;
            console.log(`Quantity: ${twelveBits} -> ${number} -> ${quantity}`);
        }
        
        // Parse Made IN (2 characters with table lookup, 6 bits each)
        let madeIn = '';
        for (let i = 0; i < 2 && pos + 6 <= binary.length; i++) {
            const sixBits = binary.substr(pos, 6);
            const decimal = parseInt(sixBits, 2) + 1; // Add 1 back
            const char = reverseTable[decimal] || '?';
            madeIn += char;
            pos += 6;
            console.log(`MadeIn char ${i}: ${sixBits} -> ${decimal} -> ${char}`);
        }
        
        // Set the parsed values if they are valid
        let parsed = false;
        
        if (serial && serial.length >= 2 && !document.getElementById('serial').value) {
            document.getElementById('serial').value = serial;
            console.log('Set serial from RFID:', serial);
            parsed = true;
        }
        
        if (shortSku && shortSku.length === 6 && !document.getElementById('shortSku').value) {
            document.getElementById('shortSku').value = shortSku;
            console.log('Set shortSku from RFID:', shortSku);
            parsed = true;
        }
        
        if (quantity && !document.getElementById('quantity').value) {
            document.getElementById('quantity').value = quantity;
            console.log('Set quantity from RFID:', quantity);
            parsed = true;
        }
        
        if (madeIn && madeIn.length === 2 && !document.getElementById('madeIn').value) {
            document.getElementById('madeIn').value = madeIn;
            console.log('Set madeIn from RFID:', madeIn);
            parsed = true;
        }
        
        if (parsed) {
            console.log('RFID code parsed successfully');
            return true;
        }
        
    } catch (e) {
        console.error('Error parsing RFID code:', e);
    }
    return false;
}

function highlightParsedFields() {
    const fields = ['serial', 'shortSku', 'quantity', 'madeIn', 'supplierId', 'batch', 'originPref'];
    
    fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && field.value) {
            const originalBorder = field.style.border;
            const originalBackground = field.style.backgroundColor;
            
            field.style.border = '3px solid #4CAF50';
            field.style.backgroundColor = '#e8f5e8';
            
            setTimeout(() => {
                field.style.border = originalBorder;
                field.style.backgroundColor = originalBackground;
            }, 3000);
        }
    });
}

function logCurrentValues() {
    console.log('Current field values:');
    const fields = ['serial', 'shortSku', 'quantity', 'madeIn', 'supplierId', 'batch', 'originPref'];
    
    fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            console.log(fieldId + ':', field.value);
        }
    });
}



// Override the existing generateCode function calls
const originalGenerateCode = window.generateCode;
window.generateCode = function() {
    if (isReverseMode) {
        parseCodestoProductData();
    } else {
        originalGenerateCode.apply(this, arguments);
    }
};

// Enhanced Enter key functionality with visual feedback
document.addEventListener('DOMContentLoaded', function() {
    const inputFields = document.querySelectorAll('input[type="text"], input[type="number"]');
    
    inputFields.forEach(input => {
        input.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                
                // Visual feedback - flash the input
                const originalBorder = this.style.border;
                this.style.border = '2px solid #4CAF50';
                
                setTimeout(() => {
                    this.style.border = originalBorder;
                }, 200);
                
                // Execute appropriate function based on mode
                if (isReverseMode) {
                    console.log('Enter pressed - Parsing codes...');
                    parseCodestoProductData();
                } else {
                    console.log('Enter pressed - Generating code...');
                    generateCode();
                }
            }
        });
    });
});

// Typewriter effect function
function typewriterEffect(element, text, speed = 30, callback) {
    // Clear the element first
    element.innerHTML = '';
    
    let index = 0;
    
    // Add cursor
    const cursor = document.createElement('span');
    cursor.className = 'typing-cursor';
    element.appendChild(cursor);
    
    const typeInterval = setInterval(() => {
        if (index < text.length) {
            // Insert character before cursor
            const textNode = document.createTextNode(text.charAt(index));
            element.insertBefore(textNode, cursor);
            index++;
        } else {
            // Finished typing - remove cursor
            clearInterval(typeInterval);
            cursor.remove();
            
            // Call callback if provided
            if (callback) callback();
        }
    }, speed);
}

// Enhanced version with multiple elements typing in sequence
function typewriterSequence(elements, speed = 90) {
    let currentIndex = 0;
    
    function typeNext() {
        if (currentIndex < elements.length) {
            const { element, text } = elements[currentIndex];
            typewriterEffect(element, text, speed, () => {
                currentIndex++;
                typeNext();
            });
        }
    }
    
    typeNext();
}


</script>

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="stilsla" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="12" data-y_margin="30">
</script>




</body>
</html>
