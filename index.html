<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Digital Codes Generator</title>
    <link rel=icon type=image/x-icon
          href="C:\Users\astafieni\OneDrive - Louis Vuitton Malletier\Code generator LV\schedule.png">
    <script src=https://cdn.jsdelivr.net/npm/bwip-js@3.0.0/dist/bwip-js.min.js></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">	
<style>
			body {
			background-color: #f9f7f4;
			background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c8b897' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
			background-attachment: fixed;
			min-height: 100vh;
			margin: 0;
			padding: 20px;
			display: grid;
			grid-template-areas: 
				"header header"
				"generate generate"
				"donation donation"
				"form main"
				"form main";
			grid-template-columns: 350px 1fr; /* Only 2 columns now */
			grid-template-rows: auto 1fr auto;
			gap: 20px;
			align-items: start;
		}

		/* Header area for buttons */
		.header-section {
			grid-area: header;
			display: flex;
			flex-direction: column;
			gap: 0px;
			font-size: 24px;
			padding: 20px 40px;
			background-color: #4CAF50;
		
		}

		button {
			font-size: 24px;
			padding: 20px 40px;
			background-color: #4CAF50;
			color: white;
			border: none;
			cursor: pointer;
			border-radius: 5px;
			margin-bottom: 20px;
			margin-top: 10px;
		}

		button:hover {
			background-color: #3e8e41;
		}

		.utility-button {
			font-size: 12px;
			padding: 6px 12px;
			background-color: #007bff;
			color: white;
			border: none;
			cursor: pointer;
			border-radius: 4px;
			margin-right: 10px;
			margin-bottom: 10px;
		}

		.utility-button:hover {
			background-color: #3e8e41;
		}

		/* Form container - LEFT COLUMN */
		#FormContainer {
			grid-area: form;
			width: 100%;
			padding: 20px;
			border: 1px solid #ccc;
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
			align-items: flex-start;
			border-radius: 8px;
			align-self: start;
			position: sticky;
			top: 20px;
			gap: 10px;
		}

		/* Main content area - RIGHT COLUMN (Contains generated code, binary, and image) */
		#mainContainer {
			grid-area: main;
			display: flex;
			flex-direction: column; /* Stack all three vertically */
			align-items: stretch; /* Full width for child elements */
			box-sizing: border-box;
			width: 100%;
			gap: 15px; /* Space between all sections */
			padding: 15px;
			border: 1px solid #ccc;
			border-radius: 8px;
		}

		/* Generated code section - FIRST in main container */
		#generatedCode {
			width: 100%;
			padding: 15px;
			border: 1px solid #ddd;
			border-radius: 6px;
			box-sizing: border-box;
			order: 1; /* First position */
		}

		/* Binary code section - SECOND in main container */
		#binaryCodeSection {
			width: 100%;
			padding: 15px;
			border: 1px solid #ddd;
			border-radius: 6px;
			box-sizing: border-box;
			text-align: left;
			order: 2; /* Second position */
		}

		/* Product image section - THIRD in main container */
		#productImageSection {
			width: 100%;
			text-align: center;
			box-sizing: border-box;
			padding: 15px;
			border: 1px solid #ddd;
			border-radius: 6px;
			order: 3; /* Third position */
		}

		.code-result-container {
			display: flex;
			align-items: center;
			justify-content: flex-start;
			gap: 10px;
		}

		#productImage {
			max-width: 100%;            /* Reduced width (adjust as needed) */
			height: auto;                   /* Auto height */
			aspect-ratio: 21 / 7;           /* Enforce 16:9 aspect ratio */
			border-radius: 4px;
			object-fit: contain;            /* Make sure whole image is visible */
			object-position: center;        /* Center the image */
		}

		#copyright {
			position: fixed;
			bottom: 10px;
			right: 10px;
			font-size: 12px;
			color: #666;
			padding: 5px;
			background-color: rgba(255, 255, 255, 0.7);
			border-radius: 3px;
			z-index: 1000;
		}

		/* Input and form styling */
		.input-group {
			width: 100%;
			margin-bottom: 10px;
			display: flex;
			flex-direction: column;
			align-items: flex-start;
		}

		label {
			display: block;
			margin-bottom: 5px;
			font-weight: bold;
			text-align: left;
			width: 100%;
		}

		input[type="text"], 
		input[type="number"] {
			padding: 8px;
			font-size: 16px;
			border: 1px solid #ccc;
			border-radius: 4px;
			width: 100%;
			box-sizing: border-box;
		}

		.hidden-label {
			display: none;
		}

		.hidden {
			display: none;
		}

		.serial-container {
			width: 100%;
			display: flex;
			align-items: center;
		}

		#barcodeImage {
			text-align: center;
			margin-top: 10px;
		}

		#barcodeImage canvas {
			border: 1px solid #ccc;
			padding: 10px;
			background-color: white;
			border-radius: 4px;
		}

		/* Section titles styling */
		#codeTitle {
			font-size: 18px;
			color: #8e44ad;           /* Purple */
			font-style: italic;
			text-decoration: underline;
		}

		#productTitle {
			font-size: 18px;
			color: #8e44ad;           /* Purple */
			font-style: italic;
			text-decoration: underline;
		}

		
		/* For Binary and Product Image titles */
		#codeTitle h3,
		#binaryCodeSection h3,
		#productImageSection h3 {
			margin-top: 0;
			margin-bottom: 15px;
			font-size: 18px;           /* Larger font */
			color: #007bff;            /* Blue color */
			font-weight: 600;          /* Semi-bold */
			text-align: center;        /* Center align */
			border-bottom: 2px solid #007bff; /* Underline */
			padding-bottom: 5px;       /* Space above border */
		}

		/* Responsive design */
		@media (max-width: 1200px) {
			body {
				grid-template-areas: 
					"header"
					"form"
					"main";
				grid-template-columns: 1fr;
				grid-template-rows: auto auto 1fr;
				gap: 20px;
			}
			
			#FormContainer {
				position: static;
			}
		}

		/* Mobile responsive design */
		@media (max-width: 768px) {
			body {
				grid-template-areas: 
					"header"
					"form"  
					"main";
				grid-template-columns: 1fr;
				grid-template-rows: auto auto 1fr;
				padding: 10px;
			}
			
			#FormContainer {
				position: static;
			}
			
			#mainContainer {
				flex-direction: column;
			}

			#generatedCode,
			#binaryCodeSection,
			#productImageSection {
				width: 100%;
			}
		}

		.close-button {
			position: absolute;
			top: 10px;
			right: 15px;
			background: rgba(255,255,255,0.2);
			color: white;
			border: none;
			font-size: 24px;
			cursor: pointer;
			padding: 5px 10px;
			border-radius: 50%;
			font-weight: bold;
			transition: background 0.2s ease;
		}

		.close-button:hover {
			background: rgba(255,255,255,0.3);
			transform: scale(1.1);
		}

				/* Tiny show button styling */
		.tiny-show-button {
			position: fixed;
			top: 20px;
			right: 20px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border: none;
			padding: 8px;
			border-radius: 50%;
			cursor: pointer;
			font-size: 16px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.3);
			z-index: 1001;
			width: 40px;
			height: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s ease;
			border: 2px solid rgba(255,255,255,0.3);
		}

		.tiny-show-button:hover {
			transform: scale(1.1);
			box-shadow: 0 4px 15px rgba(0,0,0,0.4);
		}


	/*	
		/* Donation Section Styling */
		#donationSection {
			grid-area: header;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			padding: 20px;
			border-radius: 10px;
			text-align: center;
			color: white;
			box-shadow: 0 4px 15px rgba(0,0,0,0.2);
		}

		#donationSection h2 {
			margin-top: 0;
			margin-bottom: 20px;
			font-size: 24px;
			text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
		}

		#donationContent {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 30px;
			flex-wrap: wrap;
		}

		#qrCodeContainer {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 10px;
		}

		#donationQR {
			border-radius: 10px;
			border: 3px solid rgba(255,255,255,0.3);
			background: white;
			padding: 3px;
			box-shadow: 0 4px 10px rgba(0,0,0,0.2);
		}

		#qrCodeContainer p {
			margin: 0;
			font-size: 15px;
			opacity: 0.9;
		}

		/* Responsive adjustments */
		@media (max-width: 768px) {
			#donationContent {
				flex-direction: column;
				gap: 10px;
			}
			
			#donationButton {
				font-size: 9px;
				padding: 8px 25px;
			}
			
			#donationSection h2 {
				font-size: 10px;
			}
		}
		*/


		/* Halloween mode body styles */
		body.halloween-mode {
			background: linear-gradient(45deg, #1a1a1a, #2d1b3d) !important;
			background-image: none !important;
			color: #ff6b35 !important;
			transition: background 0.5s ease, color 0.5s ease;
		}

		body.halloween-mode.spooky-cursor {
			cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text y="28" font-size="28">🎃</text></svg>'), auto !important;
		}

		/* Floating emoji animation */
		.floating-emoji {
			position: fixed;
			font-size: 30px;
			pointer-events: none;
			z-index: 1000;
			animation: float 8s infinite ease-in-out;
			opacity: 0;
		}

		@keyframes float {
			0%, 100% { 
				transform: translateY(100vh) rotate(0deg); 
				opacity: 0; 
			}
			10%, 90% { 
				opacity: 1; 
			}
			50% { 
				transform: translateY(-100px) rotate(180deg); 
			}
		}

		@keyframes glow {
			from { text-shadow: 0 0 20px #ff6b35; }
			to { text-shadow: 0 0 30px #ff6b35, 0 0 40px #ff6b35; }
		}

		/* Glowing effect for titles in Halloween mode */
		body.halloween-mode h3 {
			animation: glow 2s ease-in-out infinite alternate;
		}

		/* Halloween toggle button */
		#halloweenToggle {
			font-size: 16px;
			padding: 20px 40px;
			padding: 20px 40px;
			background: linear-gradient(45deg, #ff6b35, #ff8c42);
			color: white;
			border: none;
			cursor: pointer;
			border-radius: 8px;
			top: 0px;
			margin-right: 500px;
			transition: all 0.3s ease;
			box-shadow: 0 2px 5px rgba(0,0,0,0.3);
		}

		#halloweenToggle:hover {
			background: linear-gradient(45deg, #ff8c42, #ff6b35);
			transform: scale(1.05);
		}

		#halloweenToggle.active {
			background: linear-gradient(45deg, #2d1b3d, #1a1a1a);
			animation: glow 2s ease-in-out infinite alternate;
		}

</style>

</head>
<body>
    
		<div class=generate-section>
			<button onclick=generateCode()>Generate Code</button>
		</div>

		<div class=halloweensection>
			<button id="halloweenToggle" onclick="toggleHalloweenMode()">🎃 Halloween Mode</button>
		</div>


	<!--<div id="donationSection">
			<button id="hideDonationBtn" class="close-button" onclick="hideDonation()">&times;</button>
			<h2>Support This Project</h2>
			<div id="donationContent">
			<a href="https://www.buymeacoffee.com/stilsla"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&emoji=&slug=stilsla&button_colour=FFDD00&font_colour=000000&font_family=Cookie&outline_colour=000000&coffee_colour=ffffff" /></a>
			<div id="qrCodeContainer">
            <img id="donationQR" src="https://api.qrserver.com/v1/create-qr-code/?size=80x80&data=https://buymeacoffee.com/YOUR_USERNAME" alt="Donation QR Code">
            <p>Scan to donate</p>
			</div>
			</div>
		</div> -->

		<!-- Tiny show button (hidden by default) -->
<!--<div id="showDonationBtn" class="tiny-show-button" onclick="showDonation()" style="display:none;">
    💝
</div> 
-->

		<div id="FormContainer">
        <div class="serial-container">
            <div class="input-group">
                <label for="serial" class="hidden-label">Serial (13-14 chars):</label>
                <input type="text" id="serial" name="serial" maxlength="14">
                <button type="button" class="utility-button" onclick="focusSerial()">Edit Serial</button>
            </div>
        </div>
         <div class="utility-buttons">
            <button class="utility-button" onclick="resetToDefaults()">Reset to Default Values</button>
            <button class="utility-button" onclick="clearAllFields()">Clear All Fields</button>
        </div>

        <div class="input-group">
            <label for="shortSku">ShortSKU (6 chars):</label>
            <input type="text" id="shortSku" name="shortSku" maxlength="6">
        </div>
        
        <div class="input-group">
            <label for="quantity">Quantity (4 digits):</label>
            <input type="number" id="quantity" name="quantity" min="0" max="9999">
        </div>
        
        <div class="input-group">
            <label for="madeIn">Made IN (2 chars):</label>
            <input type="text" id="madeIn" name="madeIn" maxlength="2">
        </div>
        
        <div class="input-group">
            <label for="supplierId">Supplier ID (3 chars):</label>
            <input type="text" id="supplierId" name="supplierId" maxlength="3">
        </div>
        
        <div class="input-group">
            <label for="batch">Batch (3-17 chars):</label>
            <input type="text" id="batch" name="batch" minlength="3" maxlength="17">
        </div>
        
        <div class="input-group">
            <label for="originPref">Origin Pref (3-17 chars):</label>
            <input type="text" id="originPref" name="originPref" minlength="3" maxlength="17">
        </div>
        
        <button onclick="generateCode()">Generate code</button>
</div>
    
		 <div id="mainContainer">
			<div id="generatedCode">
				<div id="codeTitle">
					<h3>2D Data Matrix code PCE</h3>
				</div>
				<div class="code-result-container">
					<div id="codeResult"></div>
					<button id="copyButton" class="utility-button">Copy</button>
				</div>
				<div id="barcodeImage"></div>
			</div>
			
			<div id=binaryCodeSection>
				<h3>RFID code</h3>
				<div class=code-result-container>
				<div id=binaryResult></div>
				<button id=copyBinaryButton class=utility-button>Copy</button>
			</div>
			</div>

			<div id="productImageSection">
			<h3>Product Image</h3>
			<a id="productImageLink" href="#" target="_blank">
				<img id="productImage" src="" alt="Product Image">
			</a>
			</div>
		</div>
</div>
    
    	
	<div id="copyright">
    &copy; Nikita Astafiev. All rights reserved V.1.1.2 Halloween Edition
	</div>



</body>



<script>

let currentShortSku = '';

// Halloween mode variables
let halloweenMode = false;
let halloweenInterval;
let originalTitle = document.title;
const halloweenEmojis = ['🎃', '👻', '🦇', '🕷️', '🕸️', '💀', '🌙', '⭐', '🍂', '🧙‍♀️'];
const spookyTitles = [
    '🎃 Happy Halloween!',
    '👻 Boo!',
    '🦇 Spooky Time!',
    '💀 Enter if you dare...',
    '🕷️ Web of Terror!'
];
let titleIndex = 0;
let titleInterval;


function updateProductImage() {
    const shortSkuValue = document.getElementById('shortSku').value;
    const imageSection = document.getElementById('productImageSection');
    
		// For production, set 20% probability
    //const showAlternateImage = Math.random() < 0.2;
        
     //if (showAlternateImage) {
        // Use the PayPal image path similar to how the favicon is referenced
        //const alternateImageUrl = "PayPal.png";
        //document.getElementById('productImage').src = alternateImageUrl;
        //document.getElementById('productImageLink').href = "#"; // No external link needed
        
        // Show the image section regardless of shortSkuValue
        //imageSection.style.display = 'block';
        //imageSection.style.top = '270px';
        
    //} else if (shortSkuValue && shortSkuValue !== currentShortSku) {
        // Show the regular Louis Vuitton product image (80% probability)
        const imageUrl = `https://fr.louisvuitton.com/images/is/image/lv/1/PP_VP_AS/louis-vuitton--${shortSkuValue}_PM2_Front%20view.jpg?wid=800&amp;hei=800`;
        
        // Update the image and link
        document.getElementById('productImage').src = imageUrl;
        document.getElementById('productImageLink').href = imageUrl;
        
        // Position the image section under the generated code
        imageSection.style.top = '270px';
        
        // Show the image section
        imageSection.style.display = 'block';
        
        // Update the current SKU
        currentShortSku = shortSkuValue;
    //} else if (!shortSkuValue && !showAlternateImage) {
        // Hide the image section if ShortSKU is empty and not showing alternate image
        //imageSection.style.display = 'none';
        currentShortSku = '';
    //}
}

function toggleHalloweenMode() {
    const body = document.body;
    const button = document.getElementById('halloweenToggle');
	const topGenerateButton = document.querySelector('.generate-section button[onclick="generateCode()"]'); // Top button
    const bottomGenerateButton = document.querySelector('#FormContainer button[onclick="generateCode()"]'); // Bottom button
    
    halloweenMode = !halloweenMode;
    
    if (halloweenMode) {
        // Activate Halloween mode
        body.classList.add('halloween-mode', 'spooky-cursor');
        button.textContent = '👻 Disable Halloween';
        button.classList.add('active');
        
         // Change specific buttons
        if (topGenerateButton) {
            topGenerateButton.dataset.originalText = topGenerateButton.textContent;
            topGenerateButton.textContent = '🎃 Trick';
        }
        if (bottomGenerateButton) {
            bottomGenerateButton.dataset.originalText = bottomGenerateButton.textContent;
            bottomGenerateButton.textContent = '👻 Treat';
        }

		// Start floating emojis
        halloweenInterval = setInterval(createFloatingEmoji, 2000);
        
        // Start changing titles
        titleInterval = setInterval(() => {
            document.title = spookyTitles[titleIndex];
            titleIndex = (titleIndex + 1) % spookyTitles.length;
        }, 3000);
        
        console.log('🎃 Halloween mode activated!');
    } else {
        // Deactivate Halloween mode
        body.classList.remove('halloween-mode', 'spooky-cursor');
        button.textContent = '🎃 Halloween Mode';
        button.classList.remove('active');
        
                 // Restore original button texts
        if (topGenerateButton && topGenerateButton.dataset.originalText) {
            topGenerateButton.textContent = topGenerateButton.dataset.originalText;
            delete topGenerateButton.dataset.originalText;
        }
        if (bottomGenerateButton && bottomGenerateButton.dataset.originalText) {
            bottomGenerateButton.textContent = bottomGenerateButton.dataset.originalText;
            delete bottomGenerateButton.dataset.originalText;
        }
				
		// Stop intervals
        if (halloweenInterval) clearInterval(halloweenInterval);
        if (titleInterval) clearInterval(titleInterval);
        
        // Restore original title
        document.title = originalTitle;
        
        // Remove all floating emojis
        const existingEmojis = document.querySelectorAll('.floating-emoji');
        existingEmojis.forEach(emoji => emoji.remove());
        
        console.log('👋 Halloween mode deactivated!');
    }
}

		function createFloatingEmoji() {
			if (!halloweenMode) return;
			
			const emoji = document.createElement('div');
			emoji.className = 'floating-emoji';
			emoji.textContent = halloweenEmojis[Math.floor(Math.random() * halloweenEmojis.length)];
			
			// Random horizontal position
			emoji.style.left = Math.random() * 100 + '%';
			
			// Random animation duration (6-10 seconds)
			emoji.style.animationDuration = (6 + Math.random() * 4) + 's';
			
			document.body.appendChild(emoji);
			
			// Remove emoji after animation completes
			setTimeout(() => {
				if (emoji.parentNode) {
					emoji.parentNode.removeChild(emoji);
				}
			}, 10000);
		}




    let counter = 0; // Initialize counter
    let serialOverride = false;

    function resetToDefaults() {
        document.getElementById('shortSku').value = 'M41414';
        document.getElementById('quantity').value = '0010';
        document.getElementById('madeIn').value = 'US';
        document.getElementById('supplierId').value = '130';
        document.getElementById('batch').value = 'FR';
        document.getElementById('originPref').value = 'UE';
        serialOverride = false; // Allow auto-generation of serial again
        generateCode();
    }
    
    function clearAllFields() {
        document.getElementById('serial').value = '';
        document.getElementById('shortSku').value = '';
        document.getElementById('quantity').value = '';
        document.getElementById('madeIn').value = '';
        document.getElementById('supplierId').value = '';
        document.getElementById('batch').value = '';
        document.getElementById('originPref').value = '';
        serialOverride = false; // Prevent auto-generation of serial
        generateCode();
    }
	
	function focusSerial() {
    const serialInput = document.getElementById('serial');
    serialInput.focus();
    
    // Optional: select all text in the field to make it easy to replace
    serialInput.select();
}

// Binary converter functions from version01.html
function convertCharWithTable(char, table) {
    var decimal = table[char] || 63;
    var bin6 = decimal.toString(2).padStart(6, '0');
    var binaryValue = parseInt(bin6, 2);
    var adjusted = binaryValue - 1;
    var finalBinary = adjusted.toString(2).padStart(6, '0');
    return {
        decimal: decimal,
        binaryFirst: bin6,
        adjusted: adjusted,
        binary: finalBinary
    };
}

function generateBinaryCode() {
    // Get values from the existing form fields
    var param1 = document.getElementById('serial').value.toUpperCase(); // Serial
    var param2 = document.getElementById('shortSku').value.toUpperCase(); // ShortSKU
    var param3 = document.getElementById('quantity').value.trim(); // Quantity
    var param4 = document.getElementById('madeIn').value.toUpperCase(); // Made IN
    
    // Character table from version01.html
    var table = {
        '0': 1, '1': 2, '2': 3, '3': 4, '4': 5, '5': 6, '6': 7, '7': 8, '8': 9, '9': 10,
        'A': 18, 'B': 19, 'C': 20, 'D': 21, 'E': 22, 'F': 23, 'G': 24, 'H': 25, 'I': 26,
        'J': 34, 'K': 35, 'L': 36, 'M': 37, 'N': 38, 'O': 39, 'P': 40, 'Q': 41, 'R': 42,
        'S': 51, 'T': 52, 'U': 53, 'V': 54, 'W': 55, 'X': 56, 'Y': 57, 'Z': 58, '[': 11,
        '#': 12, '@': 13, ':': 14, '>': 15, '?': 16, ' ': 17, '.': 28, ']': 29, '(': 30,
        '<': 31, '^': 33, '-': 43, '$': 44, '*': 45, ')': 46, ';': 47, '/': 50, ',': 60, 
        '%': 61, '=': 62, '': 63, '!': 64 
    };

    // Start with 0000
    var binary = '0000';
    var details = '<h4>Conversion Process:</h4>';
    details += 'Step 1: Fixed prefix = <span class=binary-group>0000</span><br><br>';

    // Process Parameter 1 (Serial)
    if (param1) {
        // Process first 2 characters with table (decimal-1 rule)
        for (var i = 0; i < 2 && i < param1.length; i++) {
            var char = param1[i];
            var result = convertCharWithTable(char, table);
            binary += result.binary;
        }


         // Process remaining characters as digits (direct 4-bit conversion)
        for (var i = 2; i < param1.length; i++) {
            var digit = param1[i];
            if (digit >= '0' && digit <= '9') {
                var bin4 = parseInt(digit).toString(2).padStart(4, '0');
                binary += bin4;
            }
        }
    }


    // Process Parameter 2 (ShortSKU)
    if (param2) {
        for (var i = 0; i < param2.length && i < 6; i++) {
            var char = param2[i];
            var result = convertCharWithTable(char, table);
            binary += result.binary;
        }
    }


    // Process Parameter 3 (Quantity)
    if (param3) {
        var number = parseInt(param3);
        if (!isNaN(number)) {
            var numberBinary = number.toString(2);
            var paddedBinary = numberBinary.padStart(12, '0');
            binary += paddedBinary;
        }
    }

    // Process Parameter 4 (Made IN)
    if (param4) {
        for (var i = 0; i < param4.length && i < 2; i++) {
            var char = param4[i];
            var result = convertCharWithTable(char, table);
            binary += result.binary;
        }
    }


    // Add final 0000
    binary += '0000';

    // Convert to hexadecimal
    var hexResult = '';
    var hexDetails = '<strong>Hexadecimal Conversion:</strong><br>';
    
    for (var i = 0; i < binary.length; i += 4) {
        var fourBits = binary.substr(i, 4);
        var hexDigit = parseInt(fourBits, 2).toString(16).toUpperCase();
        hexResult += hexDigit;
    }

    
    // Add final dash
    var finalResult = hexResult + '-';

    // Format binary output in groups of 4
    var formatted = '';
    for (var i = 0; i < binary.length; i += 4) {
        formatted += '<span class=binary-group>' + binary.substr(i, 4) + '</span> ';
    }

    // Display results in the binary section
    document.getElementById('binaryResult').innerHTML = 
        '<div class=hex-result>' + finalResult + '</div>';

    // Show the binary code section
    document.getElementById('binaryCodeSection').style.display = 'block';
     
}

    function generateCode() {
        const serialInput = document.getElementById('serial');
        const shortSkuInput = document.getElementById('shortSku');
        const quantityInput = document.getElementById('quantity');
        const madeInInput = document.getElementById('madeIn');
        const supplierIdInput = document.getElementById('supplierId');
        const batchInput = document.getElementById('batch');
        const originPrefInput = document.getElementById('originPref');

		// Force currentShortSKU to reset so we recalculate completely
		currentShortSku = '';

		// Update the product image based on ShortSKU
		updateProductImage();
	
        // Serial generation logic
        if (!serialOverride) {
            counter++;
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${year}${month}${day}`;
            const formattedCounter = String(counter).padStart(4, '0');
            const serialValue = `FR${formattedDate}${formattedCounter}`;
            serialInput.value = serialValue;
        }
		
		// In the window.onload function, add this event listener
serialInput.addEventListener('input', () => {
    serialOverride = true; // Remember that user has manually edited
});

// Then in the generateCode function, replace the first block with:
// Serial generation logic - only auto-generate if empty
if (serialInput.value === '') {
    serialInput.value = createSerial();
}



        // Show Labels by removing the class
        const labels = document.querySelectorAll('label');
        labels.forEach(label => {
            if (label.htmlFor !== 'serial') {
                label.classList.remove('hidden-label');
            }
        });

        //Show Generated code results by removing the class
        const generatedCodeDiv = document.getElementById('generatedCode');
        generatedCodeDiv.classList.remove('hidden');
			
		const quantityValue = quantityInput.value;
        const shortSkuValue = shortSkuInput.value;
        const supplierIdValue = supplierIdInput.value;
        const madeInValue = madeInInput.value;
        const originPrefValue = originPrefInput.value;
        const batchValue = batchInput.value;

        const code = `0_${serialInput.value}_${quantityValue}_${shortSkuValue}__${supplierIdValue}_${madeInValue}_${originPrefValue}_${batchValue}`;

        document.getElementById('codeResult').innerText = code;
        
        // Clear previous barcode
        const barcodeDiv = document.getElementById('barcodeImage');
        barcodeDiv.innerHTML = '';

        // Create canvas for the barcode
        const canvas = document.createElement('canvas');
        barcodeDiv.appendChild(canvas);

        // Generate Data Matrix barcode
        try {
            bwipjs.toCanvas(canvas, {
                bcid: 'datamatrix',
                text: code,
                scale: 1.5,
                height: 25,
                includetext: false,
                textxalign: 'center'
            });
        } catch (e) {
            barcodeDiv.innerHTML = 'Error generating barcode: ' + e;
        }
    

 // Generate binary code too
        generateBinaryCode();
    }

    window.onload = function () {

        const serialInput = document.getElementById('serial');
        const shortSkuInput = document.getElementById('shortSku');
        const quantityInput = document.getElementById('quantity');
        const madeInInput = document.getElementById('madeIn');
        const supplierIdInput = document.getElementById('supplierId');
        const batchInput = document.getElementById('batch');
        const originPrefInput = document.getElementById('originPref');
		
		 // Set up the initial product image if ShortSKU has a value
    updateProductImage();
    
    // Optional: Add event listener to automatically update when ShortSKU changes
    document.getElementById('shortSku').addEventListener('change', function() {
        // Only update if we're not in the middle of generating a code
        if (!document.activeElement || document.activeElement.id !== 'shortSku') {
            updateProductImage();
        }
    });



        // Set initial default values directly
        shortSkuInput.value = 'M41414';
        quantityInput.value = '0010';
        madeInInput.value = 'US';
        supplierIdInput.value = '130';
        batchInput.value = 'FR';
        originPrefInput.value = 'UE';

        generateCode(); // Generate initial code with default values
    };
	// Function to copy the generated code to clipboard
document.getElementById('copyButton').addEventListener('click', function() {
    const codeText = document.getElementById('codeResult').innerText;
    
    // Use modern Clipboard API if available
    if (navigator.clipboard) {
        navigator.clipboard.writeText(codeText).then(() => {
            // Provide visual feedback that copy succeeded
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            // Return to original state after 1.5 seconds
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        }).catch(err => {
            console.error('Copy failed:', err);
            alert('Copy failed. ' + err);
        });
    } else {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = codeText;
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            document.execCommand('copy');
            // Provide visual feedback
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        } catch (err) {
            console.error('Copy failed:', err);
            alert('Copy failed');
        }
        
        document.body.removeChild(textarea);
    }

	// Copy button for binary code
document.getElementById('copyBinaryButton').addEventListener('click', function() {
    const binaryText = document.getElementById('binaryResult').innerText;
    
    // Use modern Clipboard API if available
    if (navigator.clipboard) {
        navigator.clipboard.writeText(binaryText).then(() => {
            // Provide visual feedback that copy succeeded
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            // Return to original state after 1.5 seconds
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        }).catch(err => {
            console.error('Copy failed:', err);
            alert('Copy failed. ' + err);
        });
    } else {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = binaryText;
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            document.execCommand('copy');
            // Provide visual feedback
            const originalText = this.innerText;
            this.innerText = 'Copied!';
            this.style.backgroundColor = '#4CAF50';
            
            setTimeout(() => {
                this.innerText = originalText;
                this.style.backgroundColor = '#007bff';
            }, 1500);
        } catch (err) {
            console.error('Copy failed:', err);
            alert('Copy failed');
        }
        
        document.body.removeChild(textarea);
    }
});
	});

function hideDonation() {
    const donationSection = document.getElementById('donationSection');
    
    // Add transition styles
    donationSection.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
    donationSection.style.opacity = '0';
    donationSection.style.transform = 'scale(0.8)';
    
    setTimeout(function() {
        donationSection.style.display = 'none';
        document.getElementById('showDonationBtn').style.display = 'flex';
    }, 800); // Match the transition duration
}


function showDonation() {
    const donationSection = document.getElementById('donationSection');
    
    // Reset properties and start with hidden state
    donationSection.style.display = 'block';
    donationSection.style.opacity = '0';
    donationSection.style.transform = 'scale(0.5) rotate(-180deg)';
    donationSection.style.filter = 'blur(5px)';
    
    // Hide the tiny show button
    document.getElementById('showDonationBtn').style.display = 'none';
    
    // Animate in with spring effect
    setTimeout(function() {
        donationSection.style.transition = 'all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        donationSection.style.opacity = '1';
        donationSection.style.transform = 'scale(1) rotate(0deg)';
        donationSection.style.filter = 'blur(0px)';
        
        // Clear transition after animation
        setTimeout(function() {
            donationSection.style.transition = '';
        }, 600);
    }, 10);
}



function autoHideDonationWithCountdown() {
    let timeLeft = 15; // 15 seconds
    
    // Create countdown container
    const countdownContainer = document.createElement('div');
    countdownContainer.id = 'donationCountdown';
    countdownContainer.style.cssText = 'position: absolute; top: 45px; right: 15px; color: rgba(255,255,255,0.9); font-size: 12px; text-align: right; line-height: 1.3;';
    
    // Initial text
    countdownContainer.innerHTML = `Auto-close in<br><strong>${timeLeft}</strong> seconds`;
    
    // Add to donation section
    document.getElementById('donationSection').appendChild(countdownContainer);
    
    // Update countdown every second
    const countdownInterval = setInterval(function() {
        timeLeft--;
        
        if (timeLeft > 0) {
            countdownContainer.innerHTML = `Auto-close in<br><strong>${timeLeft}</strong> second${timeLeft === 1 ? '' : 's'}`;
        } else {
            countdownContainer.innerHTML = `Closing...`;
            
            // Hide after showing "Closing..." briefly
            setTimeout(function() {
                clearInterval(countdownInterval);
                const donationSection = document.getElementById('donationSection');
                if (donationSection && donationSection.style.display !== 'none') {
                    hideDonation();
                }
            }, 500); // Wait 0.5 seconds before actually hiding
        }
    }, 1000);
    
    // Clear countdown if user manually closes
    document.getElementById('hideDonationBtn').addEventListener('click', function() {
        clearInterval(countdownInterval);
        if (document.getElementById('donationCountdown')) {
            document.getElementById('donationCountdown').remove();
        }
    });
}

// Start countdown when page loads
window.addEventListener('load', function() {
    autoHideDonationWithCountdown();
});



</script>

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="stilsla" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="12" data-y_margin="30">
</script>




</body>
</html>

